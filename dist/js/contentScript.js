(()=>{"use strict";var e=[{pro:0,color:"#FFE652"},{pro:1,color:"#FCD21C"}];const t=function(){function t(){this.canvas=document.getElementById("yylive_bear")}return t.prototype.init=function(){this.canvasRender()},t.prototype.dbclick=function(e){var t=this;this.canvas.addEventListener("dblclick",(function(){var o=document.createElement("audio");o.src="https://web.yystatic.com/project/nearlive-static/mobile/voices/voice_02.mp3",o.autoplay=!0,document.body.appendChild(o),o.addEventListener("ended",(function(){document.body.removeChild(o)})),e();var r=t.canvas.getContext("2d");t.drawChatBox(r,10,10,100,100)}))},t.prototype.canvasRender=function(){var t=this.canvas.getContext("2d");t.save(),t.beginPath(),t.moveTo(20,115),t.bezierCurveTo(35,140,115,140,130,115),t.bezierCurveTo(130,115,155,80,90,45),t.bezierCurveTo(130,160,160,20,100,52),t.bezierCurveTo(100,52,95,48,90,45),t.bezierCurveTo(88,45,95,28,70,45),t.bezierCurveTo(70,45,65,48,62,50),t.bezierCurveTo(62,50,20,20,25,78),t.bezierCurveTo(25,78,50,60,70,45),t.bezierCurveTo(70,45,0,75,20,115),function(e,t,o,r,n,i){for(var a=e.createLinearGradient(20,115,135,135),c=0;c<i.length;c++)a.addColorStop(i[c].pro,i[c].color);e.fillStyle=a,e.fill()}(t,0,0,0,0,e),t.closePath(),t.restore(),t.save(),t.beginPath(),t.moveTo(52,55),t.bezierCurveTo(52,55,30,40,35,68),n(t,"#8D4F1F"),t.closePath(),t.restore(),t.save(),t.beginPath(),t.moveTo(125,74),t.bezierCurveTo(125,74,130,50,110,58),n(t,"#8D4F1F"),t.closePath(),t.restore(),t.save(),t.beginPath(),t.moveTo(78,80),t.bezierCurveTo(70,55,40,65,35,95),t.bezierCurveTo(35,95,30,122,60,110),t.bezierCurveTo(60,110,80,95,100,110),t.bezierCurveTo(100,110,125,125,122,96),t.bezierCurveTo(122,90,106,45,87,80),t.bezierCurveTo(87,80,84,85,78,80),t.closePath(),n(t,"#8D4F1F"),t.restore(),r(t,60,88,10,13,"#FFF"),r(t,61,88,8,10,"#8D4F1F"),r(t,64,85,3,4,"#fff");var o=this.canvas;function r(e,t,o,r,i,a){var c=r>i?1/r:1/i;e.beginPath(),e.moveTo(t+r,o);for(var u=0;u<2*Math.PI;u+=c)e.lineTo(t+r*Math.cos(u),o+i*Math.sin(u));e.closePath(),n(e,a)}function n(e,t){e.fillStyle=t,e.fill()}!function(){t.save();var e=!0,n=14,i=0;function a(){0===n?e=!1:14===n&&(i++,e=!0),e?n--:n++,t.beginPath();var o=.5522848,a=10*o,c=13*o;t.moveTo(92,89),t.bezierCurveTo(92,89-c,102-a,76,102,76),t.bezierCurveTo(102+a,76,112,89-c,112,89),t.bezierCurveTo(112,89+c,102+a,102,102,102),t.bezierCurveTo(102-a,102,92,89+c,92,89),t.fillStyle="#fff",t.fill(),r(t,102,89,8,10,"#8D4F1F"),r(t,104,87,3,4,"#fff"),t.beginPath(),t.strokeStyle="#8D4F1F";for(var u=0;u<25;u++)t.moveTo(89.5+u,89-n),t.lineTo(89.5+u,89-Math.floor(23*Math.sin(Math.PI*u/25))),t.moveTo(89.5+u,89+n),t.lineTo(89.5+u,89+Math.floor(23*Math.sin(Math.PI*u/25))),t.stroke();t.closePath()}a(),o.addEventListener("click",(function(){var e=setInterval((function(){1===i?(clearInterval(e),i=0):a()}),25)})),t.restore()}(),t.save(),t.moveTo(74,114),t.beginPath(),t.bezierCurveTo(74,114,80,124,88,114),t.closePath(),n(t,"#8D4F1F"),t.restore()},t.prototype.drawChatBox=function(e,t,o,r,n){e.beginPath(),e.moveTo(t,o+.35*n),e.quadraticCurveTo(t+.04*r,o+.02*n,t+.5*r,o),e.quadraticCurveTo(t+.96*r,o+.02*n,t+r,o+.35*n),e.quadraticCurveTo(t+r,o+.7*n,t+.58*r,o+.72*n),e.quadraticCurveTo(t+.5*r,o+.9*n,t+.2*r,o+n),e.quadraticCurveTo(t+.38*r,o+.8*n,t+.38*r,o+.72*n),e.quadraticCurveTo(t,o+.7*n,t,o+.35*n),e.stroke()},t}();var o=function(){function e(){this.init(),this.mediaRecorder=null}return e.prototype.init=function(){var e=document.createElement("div");e.id="yybear_pop",e.appendChild(this.createFrag("<canvas id='yylive_bear'></canvas>")),document.body.appendChild(e),this.render()},e.prototype.createFrag=function(e){return document.createRange().createContextualFragment(e)},e.prototype.render=function(){var e=new t;e.init(),e.dbclick((function(){}))},e.prototype.getAudioRecorder=function(){return e=this,t=void 0,r=function(){var e,t=this;return function(e,t){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(o){switch(o.label){case 0:return this.mediaRecorder?[3,2]:navigator.mediaDevices.getUserMedia?[4,navigator.mediaDevices.getUserMedia({audio:!0})]:(alert("很抱歉，当前浏览器不支持该功能~"),[2]);case 1:if(e=o.sent(),console.log("stream:",e),!e)return console.error("授权失败"),[2];console.log("授权成功"),this.mediaRecorder=new MediaRecorder(e),o.label=2;case 2:return console.log(this.mediaRecorder),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(e){console.log("===="),console.log(e)},setTimeout((function(){var e;console.log("时间到"),null===(e=t.mediaRecorder)||void 0===e||e.stop()}),5e3),[2]}}))},new((o=void 0)||(o=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}));var e,t,o,r},e}();window.onload=function(){new o}})();